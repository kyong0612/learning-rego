# 7.イテレーション

## 変数キー

- 未定義の変数をキーに使う

```rego
allow {
    roles := ["developer", "viewer", "admin"]
    roles[s] == "admin"
}
```

- 未定義の変数を使って配列やオブジェクトを参照すると「条件に一致する全ての値が勝手に代入される」

## someキーワード

- someキーワードは、参照に使う変数キーを明示的に宣言するために利用する

```rego
allow {
    some i
    roles[i] == "admin"
}
```

- 公式では`some`キーワードの利用が推奨されている
  - 未定義の変数のつもりで使っていた変数に値を代入すると、エラーなどにはならないまま意図しない挙動になってしまう恐れがあるため

## アンダースコア

- 条件に一致したキーをほかの条件式にりようする必要がない、つまりイテレーションによって得られた値だけを検査したり別の変数の生成に利用したい場合、変数キーの代わりにアンダースコアを使うことができる

```rego
allow {
    input.roles[_] == "admin"
}
```

## 内包表記

```rego
names := [name | sites[i].region == "ap-northeast-i"; name := sites[i].name]
```
